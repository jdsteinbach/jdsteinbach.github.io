<!doctype html>
<html lang="en" xmlns="https://www.w3.org/1999/xhtml" xmlns:og="https://ogp.me/ns#" xmlns:fb="https://www.facebook.com/2008/fbml">

<head itemscope itemtype="http://schema.org/WebSite">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#5CACC4">
  <title itemprop="name">Changing WordPress Query Vars for Specific Archive Pages | James Steinbach</title>
  <meta name="description" content="">
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Changing WordPress Query Vars for Specific Archive Pages | James Steinbach" />
  <meta property="og:description" content="Front-end Architect. Speaker & writer. Sass, CSS Animation, RWD & WP." />
  <meta property="og:url" content="https://jdsteinbach.com" />
  <meta property="og:site_name" content="" />
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:description" content="Front-end Architect. Speaker & writer. Sass, CSS Animation, RWD & WP."/>
  <meta name="twitter:title" content="Changing WordPress Query Vars for Specific Archive Pages | James Steinbach"/>
  <meta name="twitter:domain" content="https://jdsteinbach.com"/>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://jdsteinbach.com/wordpress/changing-wordpress-query-vars-specific-archive-pages/" itemprop="url">
  <link rel="alternate" type="application/rss+xml" title="" href="https://jdsteinbach.com/feed.xml" />
</head>

  <body>

<header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="https://jdsteinbach.com/">James Steinbach</a>

    <nav class="site-nav">
      
    </nav>

  </div>

</header>

    <div class="page-content" id="main" role="main">

      <div class="wrapper">
<div class="post inner-wrapper">

  <header class="post-header">
    <h1 class="post-title">Changing WordPress Query Vars for Specific Archive Pages</h1>
    <p class="post-meta">
      <span class="date">Dec 31, 1969</span>
 <span class="author">James Steinbach</span>             <span class="categories">  
</span>    </p>
  </header>

  <article class="post-content">
    <p>When you develop a WordPress theme with multiple custom post types or taxonomies, you&#8217;ll inevitably find yourself needing to change some query vars for specific archives. For example, you may want to change the default blog archive from 10 posts to 5, but on the archive page that displays portfolio items, you want to show the most recent 12 items. On the staff page, you want to sort people by menu order with no post limit. The recommended resources page should sort posts alphabetically without a post limit. You could set all those archive pages up by building a <a title="WordPress Codex: Custom Page Template" href="http://codex.wordpress.org/Page_Templates" target="_blank">custom page template</a> that uses a <a title="WordPress Codex: WP_Query" href="http://codex.wordpress.org/Class_Reference/WP_Query" target="_blank">new WP_query</a> with custom vars for each one, and assigning a Page to each template.</p>
<p>A cleaner solution is to use WordPress&#8217;s own <a title="WordPress Codex: Template Hierarchy" href="http://codex.wordpress.org/Template_Hierarchy" target="_blank">template hierarchy</a> to generate archives for each post type. For your custom post types (slugs: portfolio, staff, resource), you&#8217;d create <code>archive-portfolio.php</code>, <code>archive-staff.php</code>, and <code>archive-resource.php</code>. Those archive template files will be used whenever WordPress&#8217;s permalink URLs are used to call archives for each post type. By default, they&#8217;ll use WordPress&#8217;s default query vars: limit to 10 posts (or whatever number is saved in Settings &gt; Reading) in descending order by date. We can add (and adjust) the following snippet in <code>functions.php</code> to modify the query vars used on each of those template pages:</p>
<pre><code class="lang-php">add_action( &#39;pre_get_posts&#39;, &#39;custom_query_vars&#39; );
function custom_query_vars( $query ) {
  if ( !is_admin() &amp;&amp; $query-&gt;is_main_query() {
    if ( get_post_type() == &#39;portfolio&#39; ) {
      $query-&gt;set( &#39;posts_per_page&#39; =&gt; 12 );
    }
    if ( get_post_type() == &#39;staff&#39; ) {
      $query-&gt;set( &#39;posts_per_page&#39; =&gt; -1 );
      $query-&gt;set( &#39;orderby&#39; =&gt; &#39;menu_order&#39; );
      $query-&gt;set( &#39;order&#39; =&gt; &#39;ASC&#39; );
    }
    if ( get_post_type() == &#39;resource&#39; ) {
      $query-&gt;set( &#39;posts_per_page&#39; =&gt; -1 );
      $query-&gt;set( &#39;orderby&#39; =&gt; &#39;title&#39; );
      $query-&gt;set( &#39;order&#39; =&gt; &#39;ASC&#39; );
    }
  }
  return $query;
}
</code></pre>
<p>The first line of code in that block adds the function <code>custom_query_vars()</code> to the <a title="WordPress Codex: Action - pre_get_posts" href="http://codex.wordpress.org/Plugin_API/Action_Reference/pre_get_posts" target="_blank"><code>pre_get_posts</code></a> WordPress action: any time WordPress runs a post query, our custom function will run with the ability to modify query vars.</p>
<p>In our custom function, the first thing we do is use an <code>if</code> statement to limit where our modifications happen. The <code>!is_admin()</code> condition prevents custom query modifications from affecting the Dashboard. The <code>$query-&gt;is_main_query()</code> condition makes sure our changes only happen to the main query on a given archive page (for example, sidebar widgets won&#8217;t be affected by our tweaks).</p>
<p>Inside that condition, we&#8217;ve got the three <code>if</code> statements we&#8217;ll need to modify each of our custom post type archives. Inside of each <code>if</code>, we use <code>$query-&gt;set()</code>; to change the appropriate query vars. For portfolio items, we change the <code>posts_per_page</code> var to 12. For the staff archive, we remove the post limit (<code>&#39;posts_per_page&#39; =&gt; -1</code>) and order items by <code>menu_order</code> in ascending order. For resource archive pages, we remove the post limit and order posts by their title in ascending order (alphabetical).</p>
<blockquote>
<p>Note: <code>$query-&gt;set( $var, $value );</code> is simply a WordPress alias function for <code>query_vars[$var] = $value;</code>. The function <code>set_query_var( $var, $value );</code> does the same thing, but can run outside of the <code>pre_get_posts</code> action.</p>
</blockquote>
<p>This code snippet can also change query vars on individual categories. For example, if you wanted the posts in a specific blog category to be ordered differently, you&#8217;d replace <code>if ( get_post_type() == $post_type )</code> with <code>if ( is_category( $category_slug ) )</code>. For a custom taxonomy, you could use <code>if ( is_tax( $taxonomy, $term ) )</code>. WordPress has several <a title="WordPress Codex: Conditional Tags" href="http://codex.wordpress.org/Conditional_Tags" target="_blank">conditional tags</a> you can use to modify specific queries.</p>

  </article>

</div>

      </div>
    </div>

<footer class="site-footer" role="contentinfo">
  <div class="wrapper">

    <!-- Begin MailChimp Signup Form -->
    <div id="mc_embed_signup">
      <!-- Submit via Ajax: http://stackoverflow.com/a/16172798 -->
      <form action="//jamessteinbach.us7.list-manage.com/subscribe/post?u=e06400c5106eb26339f4a0aea&amp;id=35bef0e04e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
          <h2>Get New Posts &amp; Other Content in Your Inbox!</h2>
          <div class="mc-fields">
            <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
            <div class="mc-field-group email">
              <label for="mce-EMAIL">Email Address<span class="asterisk">*</span></label>
              <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
            </div>
            <div class="mc-field-group fname">
              <label for="mce-FNAME">First Name</label>
              <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
            </div>
            <div class="mc-field-group lname">
              <label for="mce-LNAME">Last Name </label>
              <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
            </div>
          </div>
          <div id="mce-responses" class="clear">
            <div class="response" id="mce-error-response" style="display:none"></div>
            <div class="response" id="mce-success-response" style="display:none"></div>
          </div>
          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_e06400c5106eb26339f4a0aea_35bef0e04e" tabindex="-1" value=""></div>
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button button-alt">
          <p class="mc-ref">Powered by <a href="http://eepurl.com/AtwTT" title="MailChimp - email marketing made easy and fun">MailChimp</a></p>
        </div>
      </form>
    </div>

    <!--End mc_embed_signup-->
  </div>

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>James Steinbach</li>
          <li><a href="mailto:jdsteinbach@gmail.com">jdsteinbach@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://github.com/jdsteinbach">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jdsteinbach</span>
            </a>
          </li>

          <li>
            <a href="https://twitter.com/jdsteinbach">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jdsteinbach</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p class="text">Front-end Architect. Speaker & writer. Sass, CSS Animation, RWD & WP.</p>
      </div>
    </div>
  </div>

</footer>
    <script>
    if (window.localStorage) {
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('theme-dark');
      } else {
        document.body.classList.remove('theme-dark');
      }
    }
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43397146-5', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="/assets/site.js"></script>
      </body>

</html>
