<!doctype html>
<html lang="en" xmlns="https://www.w3.org/1999/xhtml" xmlns:og="https://ogp.me/ns#" xmlns:fb="https://www.facebook.com/2008/fbml">

<head itemscope itemtype="http://schema.org/WebSite">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#5CACC4">
  <title itemprop="name">Setting Up Let’s Encrypt with VestaCP on Digital Ocean | James Steinbach</title>
  <meta name="description" content="Instructions for adding new Let’s Encrypt SSL certs to domains managed by VestaCP on a Digital Ocean (Ubuntu 14) server.">
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Setting Up Let’s Encrypt with VestaCP on Digital Ocean | James Steinbach" />
  <meta property="og:description" content="Instructions for adding new Let’s Encrypt SSL certs to domains managed by VestaCP on a Digital Ocean (Ubuntu 14) server." />
  <meta property="og:url" content="https://jdsteinbach.com" />
  <meta property="og:site_name" content="" />
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:description" content="Instructions for adding new Let’s Encrypt SSL certs to domains managed by VestaCP on a Digital Ocean (Ubuntu 14) server."/>
  <meta name="twitter:title" content="Setting Up Let’s Encrypt with VestaCP on Digital Ocean | James Steinbach"/>
  <meta name="twitter:domain" content="https://jdsteinbach.com"/>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://jdsteinbach.com/misc/letsencrypt-vesta/" itemprop="url">
  <link rel="alternate" type="application/rss+xml" title="" href="https://jdsteinbach.com/feed.xml" />
</head>

  <body>

<header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="https://jdsteinbach.com/">James Steinbach</a>

    <nav class="site-nav">
      
    </nav>

  </div>

</header>

    <div class="page-content" id="main" role="main">

      <div class="wrapper">
<div class="post inner-wrapper">

  <header class="post-header">
    <h1 class="post-title">Setting Up Let’s Encrypt with VestaCP on Digital Ocean</h1>
    <p class="post-meta">
      <span class="date">Dec 31, 1969</span>
 <span class="author">James Steinbach</span>             <span class="categories">  
</span>    </p>
  </header>

  <article class="post-content">
    <p>Ok, I’ll be totally honest here. I’m writing this post mostly for myself: I need an easy place to keep these instructions for setting up new SSL certificates. If they help you, that’s awesome. If not, hopefully there’s <a href="https://jdsteinbach.com">another post here</a> that you can learn from.</p>
<h2 id="installing-let-s-encrypt">Installing Let’s Encrypt</h2>
<p>First step: install the Let’s Encrypt tool on your server. SSH into your server, <code>cd</code> to the root dir (where you probably landed as soon as you SSHed in), and run the these commands:</p>
<pre><code class="lang-bash">git clone https://github.com/letsencrypt/letsencrypt
cd letsencrypt
./letsencrypt-auto --help
</code></pre>
<p>This will take time to install a bunch of packages, then give you a success message. You should only does these steps once. Every time you want to secure another domain on your VestaCP account, follow the next section.</p>
<h2 id="adding-let-s-encrypt-certificates">Adding Let’s Encrypt Certificates</h2>
<p>In all of these commands, replace <code>DOMAIN_GOES_HERE</code> with the domain you want to secure and <code>YOUR_VESTA_USERNAME</code> with your VestaCP username.</p>
<h3 id="installing-the-certificate">Installing the Certificate</h3>
<p>The following command will create the necessary certificates. You should still be in the <code>/letsencrypt/</code> directory where you ran the last command above. When you run this command, the UI will ask you for an email address to use for this certificate and to agree to the Terms of Service.</p>
<pre><code class="lang-shell">./letsencrypt-auto certonly -a webroot --renew-by-default --webroot-path /home/YOUR_VESTA_USERNAME/web/DOMAIN_GOES_HERE/public_html -d DOMAIN_GOES_HERE
</code></pre>
<p>That command created several files in on your server. You’ll need to copy the contents of those files to your VestaCP admin page for that domain. In Vesta, edit the domain, check the button for &quot;SSL Support&quot; &ndash; you’ll then see three new fields.</p>
<h3 id="copying-cert-files-to-vestacp">Copying Cert Files to VestaCP</h3>
<p>To view those files&#39; contents, run the following commands, then copy the file contents to the appropriate field:</p>
<pre><code class="lang-shell">cat /etc/letsencrypt/live/DOMAIN_GOES_HERE/cert.pem
</code></pre>
<p>^ Copy contents into “SSL Certificate” field.</p>
<pre><code class="lang-shell">cat /etc/letsencrypt/live/DOMAIN_GOES_HERE/privkey.pem
</code></pre>
<p>^ Copy contents into “SSL Key” field.</p>
<pre><code class="lang-shell">cat /etc/letsencrypt/live/DOMAIN_GOES_HERE/chain.pem
</code></pre>
<p>^ Copy contents into “SSL Certificate Authority” field.</p>
<h3 id="symlinks-to-the-original-files">Symlinks to the Original Files</h3>
<p>The previous steps saved those details to a series of files in <code>/home/USERNAME/conf/web/</code> you’ll actually remove all those files next:</p>
<pre><code class="lang-shell">rm /home/YOUR_VESTA_USERNAME/conf/web/ssl.DOMAIN_GOES_HERE.*
</code></pre>
<p>In place of those files you just deleted, you’ll now create a series of symlinks to the originals created by Let’s Encrypt:</p>
<pre><code class="lang-shell">ln -s /etc/letsencrypt/live/DOMAIN_GOES_HERE/fullchain.pem /home/YOUR_VESTA_USERNAME/conf/web/ssl.DOMAIN_GOES_HERE.pem
ln -s /etc/letsencrypt/live/DOMAIN_GOES_HERE/privkey.pem /home/YOUR_VESTA_USERNAME/conf/web/ssl.DOMAIN_GOES_HERE.key
ln -s /etc/letsencrypt/live/DOMAIN_GOES_HERE/cert.pem /home/YOUR_VESTA_USERNAME/conf/web/ssl.DOMAIN_GOES_HERE.crt
ln -s /etc/letsencrypt/live/DOMAIN_GOES_HERE/chain.pem /home/YOUR_VESTA_USERNAME/conf/web/ssl.DOMAIN_GOES_HERE.ca
</code></pre>
<p>Once this is done, restart your nginx and Apache servers:</p>
<pre><code class="lang-shell">service nginx restart
service apache2 restart
</code></pre>
<p>Check out your domain now, and it should be secure!</p>

  </article>

</div>

      </div>
    </div>

<footer class="site-footer" role="contentinfo">
  <div class="wrapper">

    <!-- Begin MailChimp Signup Form -->
    <div id="mc_embed_signup">
      <!-- Submit via Ajax: http://stackoverflow.com/a/16172798 -->
      <form action="//jamessteinbach.us7.list-manage.com/subscribe/post?u=e06400c5106eb26339f4a0aea&amp;id=35bef0e04e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
          <h2>Get New Posts &amp; Other Content in Your Inbox!</h2>
          <div class="mc-fields">
            <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
            <div class="mc-field-group email">
              <label for="mce-EMAIL">Email Address<span class="asterisk">*</span></label>
              <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
            </div>
            <div class="mc-field-group fname">
              <label for="mce-FNAME">First Name</label>
              <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
            </div>
            <div class="mc-field-group lname">
              <label for="mce-LNAME">Last Name </label>
              <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
            </div>
          </div>
          <div id="mce-responses" class="clear">
            <div class="response" id="mce-error-response" style="display:none"></div>
            <div class="response" id="mce-success-response" style="display:none"></div>
          </div>
          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_e06400c5106eb26339f4a0aea_35bef0e04e" tabindex="-1" value=""></div>
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button button-alt">
          <p class="mc-ref">Powered by <a href="http://eepurl.com/AtwTT" title="MailChimp - email marketing made easy and fun">MailChimp</a></p>
        </div>
      </form>
    </div>

    <!--End mc_embed_signup-->
  </div>

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>James Steinbach</li>
          <li><a href="mailto:jdsteinbach@gmail.com">jdsteinbach@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://github.com/jdsteinbach">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jdsteinbach</span>
            </a>
          </li>

          <li>
            <a href="https://twitter.com/jdsteinbach">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jdsteinbach</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p class="text">Front-end Architect. Speaker & writer. Sass, CSS Animation, RWD & WP.</p>
      </div>
    </div>
  </div>

</footer>
    <script>
    if (window.localStorage) {
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('theme-dark');
      } else {
        document.body.classList.remove('theme-dark');
      }
    }
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43397146-5', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src="/assets/site.js"></script>
      </body>

</html>
