<!DOCTYPE html>
<html lang="en" xmlns="https://www.w3.org/1999/xhtml" xmlns:og="https://ogp.me/ns#" xmlns:fb="https://www.facebook.com/2008/fbml">

<head itemscope itemtype="http://schema.org/WebSite">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title itemprop="name">Changing WordPress Query Vars for Specific Archive Pages • James Steinbach</title>
  <meta name="version" content="1.1.2" />
  <meta name="description" content="Front-end architect. Speaker & writer. Sass, CSS animation, RWD & WP." />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Changing WordPress Query Vars for Specific Archive Pages • James Steinbach" />
  <meta property="og:description" content="Front-end architect. Speaker & writer. Sass, CSS animation, RWD & WP." />
  <meta property="og:url" content="https://jdsteinbach.com/wordpress/changing-wordpress-query-vars-specific-archive-pages/" />
  <meta property="og:site_name" content="James Steinbach" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:description" content="Front-end architect. Speaker & writer. Sass, CSS animation, RWD & WP." />
  <meta name="twitter:title" content="Changing WordPress Query Vars for Specific Archive Pages • James Steinbach" />
  <meta name="twitter:url" content="https://jdsteinbach.com/wordpress/changing-wordpress-query-vars-specific-archive-pages/" />
  <meta name="twitter:site" content="@jdsteinbach" />
  <meta name="twitter:creator" content="@jdsteinbach" />

  <meta name="test-pagination" content="">

  <link rel="stylesheet" href="/styles/main.css" />
  <link rel="canonical" href="https://jdsteinbach.com/wordpress/changing-wordpress-query-vars-specific-archive-pages/" itemprop="url" />
  <link rel="alternate" type="application/rss+xml" title="James Steinbach" href="https://jdsteinbach.com/feed.xml" />

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#e65100" />
  <meta name="msapplication-TileColor" content="#e65100" />
  <meta name="theme-color" content="#e65100" />
</head>

<body class="site">
  <header class="site-header" role="banner">
  <div class="l-wrapper l-wrapper--wide">
    <a class="site-header__title" href="/">James Steinbach</a>
    <nav class="header-nav" id="header-nav"><a class="header-nav__link" href="/css/" data-order="10">CSS</a><a class="header-nav__link" href="/sass/" data-order="20">Sass</a><a class="header-nav__link" href="/wordpress/" data-order="30">WP</a><a class="header-nav__link" href="/talks/" data-order="35">Talks</a><a class="header-nav__link" href="/about/" data-order="40">About</a><a class="header-nav__link" href="/contact/" data-order="50">Contact</a></nav>
  </div>
</header>

  <main class="site-main" id="main" role="main">

  <article class="post l-page" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="hero l-hero">
      
    <svg viewBox="0 0 64 64" preserveAspectRatio="xMidYMid slice" alt="" role="presentation">
  <defs>
    <linearGradient x="0" y="0" x2="1" y2="1" spreadMethod="pad" id="lg">
      <stop offset="0" stop-color="#131313" stop-opacity="0" />
      <stop offset=".5" stop-color="#131313" stop-opacity=".05" />
      <stop offset="1" stop-color="#131313" stop-opacity=".15" />
    </linearGradient>
  </defs>
  <g transform="translate(-14 -14)">
    <rect width="28" height="28" fill="url(#lg)" y="0" x="0" />
    <rect width="28" height="28" fill="url(#lg)" y="16" x="0" />
    <rect width="28" height="28" fill="url(#lg)" y="32" x="0" />
    <rect width="28" height="28" fill="url(#lg)" y="48" x="0" />
    <rect width="28" height="28" fill="url(#lg)" y="64" x="0" />

    <rect width="28" height="28" fill="url(#lg)" y="0" x="16" />
    <rect width="28" height="28" fill="url(#lg)" y="16" x="16" />
    <rect width="28" height="28" fill="url(#lg)" y="32" x="16" />
    <rect width="28" height="28" fill="url(#lg)" y="48" x="16" />
    <rect width="28" height="28" fill="url(#lg)" y="64" x="16" />

    <rect width="28" height="28" fill="url(#lg)" y="0" x="32" />
    <rect width="28" height="28" fill="url(#lg)" y="16" x="32" />
    <rect width="28" height="28" fill="url(#lg)" y="32" x="32" />
    <rect width="28" height="28" fill="url(#lg)" y="48" x="32" />
    <rect width="28" height="28" fill="url(#lg)" y="64" x="32" />

    <rect width="28" height="28" fill="url(#lg)" y="0" x="48" />
    <rect width="28" height="28" fill="url(#lg)" y="16" x="48" />
    <rect width="28" height="28" fill="url(#lg)" y="32" x="48" />
    <rect width="28" height="28" fill="url(#lg)" y="48" x="48" />
    <rect width="28" height="28" fill="url(#lg)" y="64" x="48" />

    <rect width="28" height="28" fill="url(#lg)" y="0" x="64" />
    <rect width="28" height="28" fill="url(#lg)" y="16" x="64" />
    <rect width="28" height="28" fill="url(#lg)" y="32" x="64" />
    <rect width="28" height="28" fill="url(#lg)" y="48" x="64" />
    <rect width="28" height="28" fill="url(#lg)" y="64" x="64" />
  </g>
</svg>


      <h1 class="hero__title" itemprop="name title headline">Changing WordPress Query Vars for Specific Archive Pages</h1>

      <p class="hero__meta">
          <time class="date" datetime=Sat Jan 03 2015 00:00:00 GMT+0000 (Coordinated Universal Time) itemprop="dateCreated pubdate datePublished">January  3, 2015</time>
          <span class="author" itemprop="author creator">James Steinbach</span>
          <span class="categories">
  <a href="/wordpress/" class="category-link">[WordPress]</a>
</span>
      </p>
    </header>

    <div class="main-content l-content has-toc" itemprop="articleBody">
      <p>When you develop a WordPress theme with multiple custom post types or taxonomies, you’ll inevitably find yourself needing to change some query vars for specific archives. For example, you may want to change the default blog archive from 10 posts to 5, but on the archive page that displays portfolio items, you want to show the most recent 12 items. On the staff page, you want to sort people by menu order with no post limit. The recommended resources page should sort posts alphabetically without a post limit. You could set all those archive pages up by building a <a title="WordPress Codex: Custom Page Template" href="https://developer.wordpress.org/themes/template-files-section/page-template-files/" target="_blank">custom page template</a> that uses a <a title="WordPress Codex: WP_Query" href="http://codex.wordpress.org/Class_Reference/WP_Query" target="_blank">new WP_query</a> with custom vars for each one, and assigning a Page to each template.</p>
<p>A cleaner solution is to use WordPress’s own <a title="WordPress Codex: Template Hierarchy" href="http://codex.wordpress.org/Template_Hierarchy" target="_blank">template hierarchy</a> to generate archives for each post type. For your custom post types (slugs: portfolio, staff, resource), you’d create <code>archive-portfolio.php</code>, <code>archive-staff.php</code>, and <code>archive-resource.php</code>. Those archive template files will be used whenever WordPress’s permalink URLs are used to call archives for each post type. By default, they’ll use WordPress’s default query vars: limit to 10 posts (or whatever number is saved in Settings &gt; Reading) in descending order by date. We can add (and adjust) the following snippet in <code>functions.php</code> to modify the query vars used on each of those template pages:</p>
<pre class="language-php"><code class="language-php"><span class="highlight-line"><span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'pre_get_posts'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'custom_query_vars'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">custom_query_vars</span><span class="token punctuation">(</span> <span class="token variable">$query</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">is_main_query</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">get_post_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'portfolio'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'posts_per_page'</span><span class="token punctuation">,</span> <span class="token number">12</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">get_post_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'staff'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'posts_per_page'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'orderby'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'menu_order'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'order'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'ASC'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">get_post_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'resource'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'posts_per_page'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'orderby'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'title'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">      <span class="token variable">$query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'order'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'ASC'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>The first line of code in that block adds the function <code>custom_query_vars()</code> to the <a title="WordPress Codex: Action - pre_get_posts" href="http://codex.wordpress.org/Plugin_API/Action_Reference/pre_get_posts" target="_blank"><code>pre_get_posts</code></a> WordPress action: any time WordPress runs a post query, our custom function will run with the ability to modify query vars.</p>
<p>In our custom function, the first thing we do is use an <code>if</code> statement to limit where our modifications happen. The <code>!is_admin()</code> condition prevents custom query modifications from affecting the Dashboard. The <code>$query-&gt;is_main_query()</code> condition makes sure our changes only happen to the main query on a given archive page (for example, sidebar widgets won’t be affected by our tweaks).</p>
<p>Inside that condition, we’ve got the three <code>if</code> statements we’ll need to modify each of our custom post type archives. Inside of each <code>if</code>, we use <code>$query-&gt;set()</code>; to change the appropriate query vars. For portfolio items, we change the <code>posts_per_page</code> var to 12. For the staff archive, we remove the post limit (<code>'posts_per_page', -1</code>) and order items by <code>menu_order</code> in ascending order. For resource archive pages, we remove the post limit and order posts by their title in ascending order (alphabetical).</p>
<blockquote>
<p>Note: <code>$query-&gt;set( $var, $value );</code> is simply a WordPress alias function for <code>query_vars[$var] = $value;</code>. The function <code>set_query_var( $var, $value );</code> does the same thing, but can run outside of the <code>pre_get_posts</code> action.</p>
</blockquote>
<p>This code snippet can also change query vars on individual categories. For example, if you wanted the posts in a specific blog category to be ordered differently, you’d replace <code>if ( get_post_type() == $post_type )</code> with <code>if ( is_category( $category_slug ) )</code>. For a custom taxonomy, you could use <code>if ( is_tax( $taxonomy, $term ) )</code>. WordPress has several <a title="WordPress Codex: Conditional Tags" href="http://codex.wordpress.org/Conditional_Tags" target="_blank">conditional tags</a> you can use to modify specific queries.</p>


      <aside class="post-toc">
        <h5 class="post-toc__title">Table of Contents</h5>
        <nav class="toc"></nav>
      </aside>
    </div>
  </article>
    </main><!-- main.site-main -->
  <footer class="site-footer" role="contentinfo">
  <div class="l-wrapper">
    <form class="form form--mailchimp" action="//jamessteinbach.us7.list-manage.com/subscribe/post?u=e06400c5106eb26339f4a0aea&amp;id=35bef0e04e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
  <h2 class="site-footer__title">Get New Posts &amp; Other Content in Your Inbox!</h2>

  <div class="form__fields" id="mc_embed_signup_scroll">
    <div class="form__fields-wrapper">
      <p class="form__required-message hidden"><span class="form__required-asterisk">*</span> indicates required</p>

      <div class="form__field form__field--email">
        <label class="form__label" for="mce-EMAIL">Email Address<span class="form__required-asterisk">*</span></label>
        <input class="form__input form__input--required form__input--email" type="email" name="EMAIL" id="mce-EMAIL">
      </div>

      <div class="form__field form__field--fname">
        <label class="form__label" for="mce-FNAME">First Name</label>
        <input class="form__input" type="text" name="FNAME" id="mce-FNAME">
      </div>

      <div class="form__field form__field--lname">
        <label class="form__label" for="mce-LNAME">Last Name </label>
        <input class="form__input" type="text" name="LNAME" id="mce-LNAME">
      </div>
    </div>

    <p class="form__response-message" id="mce-response"></p>

    <label style="position: absolute; left: -5000px;" aria-hidden="true">
      <input type="text" name="b_e06400c5106eb26339f4a0aea_35bef0e04e" tabindex="-1" value="">
    </label>

    <button class="form__submit button button-alt" type="submit">Subscribe</button>

    <p class="form__monkey-rewards mc-ref">Powered by <a href="https://www.mailchimp.com/monkey-rewards/?utm_source=freemium_newsletter&utm_medium=email&utm_campaign=monkey_rewards&aid=e06400c5106eb26339f4a0aea&afl=1" target="_blank" rel="noopener nofollow noreferrer" title="MailChimp - email marketing made easy and fun">MailChimp</a></p>
  </div>
</form>

  </div>
  <div class="l-wrapper">
    <div class="site-footer__column">
      <p>James Steinbach</p>
      <p><a href="mailto:jdsteinbach@gmail.com">jdsteinbach@gmail.com</a></p>
    </div>
    <div class="site-footer__column">
        <p>
          <a href="https://github.com/jdsteinbach">
            <span class="icon icon--github">
              <svg viewBox="0 0 16 16" height="16" width="16">
  <path fill="currentColor" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>

            </span>
            <span class="username">jdsteinbach</span>
          </a>
        </p>
        <p>
          <a href="https://twitter.com/jdsteinbach">
            <span class="icon icon--twitter">
              <svg viewBox="0 0 16 16" height="16" width="16">
  <path fill="currentColor" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
</svg>

            </span>
            <span class="username">jdsteinbach</span>
          </a>
        </p>
    </div>
    <div class="site-footer__column">
      <p class="text">Front-end architect. <br />Speaker & writer. <br />Sass, CSS animation, RWD & WP.</p>
    </div>
  </div>
</footer>

  <script>
  if (window.localStorage) {
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('theme-dark');
    } else {
      document.body.classList.remove('theme-dark');
    }
  }
  </script>
  <script data-goatcounter="https://jds.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

  <script async src="/js/site.js"></script>
</body>
</html>

